### Docker基本命令

- 使用wget来获取最新的Docker版本，并安装
  - `wget -qO- https://get.Docker.com/ | sh`
- 将用户`ihge2k`添加到Docker用户组，以非`root`用户使用Docker
  - `sudo usermod -aG  docker ihge2k`
- 重新登录后便能生效，查看目前Docker状态
  - `service docker {start|stop|restart|status}`
- 验证Docker安装成功
  - `docker run hello-world`，`docker run ubuntu ls`命令首先会在`本地`寻找命令指定的镜像`ubuntu`，如果没有找到，则从Docker官方维护的Docker Hub Registry上寻找，一旦找到镜像，就会下载该镜像到本地，`docker run`会以此镜像为基础，创建并启动一个容器，最后在容器中执行命令`ls`
- Docker命令分类：
  - Docker环境信息: `info`, `version`
  - 容器生命周期管理: `create`, `exec`, `kill`, `pause`, `restart`, `rm`, `run`, `start`, `stop`, `unpause`
  - 镜像仓库命令: `login`, `logout`, `pull`, `push`, `search`
  - 镜像管理：`build`, `images`, `import`,`load`, `rmi`, `save`, `tag`,`commit`
  - 容器运维操作：`attach`,`export`,`inspect`,`port`,`ps`,`rename`,`stats`,`top`,`wait`,`cp`,`diff`
  - 系统日志信息：`events`, `history`,`logs`
- 使用`docker CMD --help`来查看某个命令的具体参数
- 查看Docker版本信息，以及目前所有的容器和镜像数量
  - `docker version`
  - `docker info`
- 创建一个具有交互`shell`容器
  - `docker run -i -t --name myubuntu ubuntu /bin/bash`
    - `-i`保证容器中`STDIN`是开启的，`-t`告诉Docker为创建的容器分配一个伪`tty`终端，然后指定运行命令`/bin/bash`，这样创建的容器才会有一个交互式的`shell`
    - `--name`选项指定`docker run`命令启动的容器的名字，如果没有此选项，会随机分配一个名字
  - 也可以通过管道与`shell`进行交互，仅仅使用参数`-i`
    - `echo "hello world" | docker run -i  ubuntu cat`
  - `-v`选项用于挂载一个volume，可以用多个`-v`参数同时挂载多个volume
    - 格式为[host-dir]:[container-dir]:[rw|ro]
  - `-p`选项用于将容器的端口暴露给宿主机的端口，其格式通常为`hostPort:containerPort`，通过端口暴露，可以让外部主机通过宿主机暴露的端口来访问容器内的应用
  - `--link`选项用于实现容器间的交互通信
- 端口映射
  - 随机分配宿主机的端口到Docker指定的端口（从宿主机的端口49153~65535中随机选一个映射到容器的80端口）
    - `docker -d -p 80 ubuntu nginx -g "daemon off"`
  - 指定容器与宿主机之间的端口映射关系（-p 宿主端口:容器端口）
    - `docker -d -p 8080:80 ubuntu nginx -g "daemon off"`
- 查看容器
  - `docker ps`：列出当前处于运行状态的`Docker container`
  - `docker ps -l`: 列出最后一次运行的容器（包括正在运行和已停止的）
  - `docker ps -a`：列出所有的容器（包括正在运行和已停止的）
  - `docker ps -n m`：列出最后m个容器（包括正在运行和已停止的）
- 对容器重新命名：`docker rename old_container_name new_container_name`
- 重新启动已经停止的容器
  - `docker start container_id`
  - `docker restart container_id`
- 创建容器：`docker create image_name`
  - ``create`与`run`命令的区别在于前者仅仅是创建一个容器而且，后者是创建并且运行一个容器
- 常看容器日志
  - `docker logs container_id`
  - 如果想监控Docker的日志，和`tail -f`命令相似，按`Ctrl + C`退出日志跟踪
    - `docker logs  -f container_id`
  - 查看最后10行日志内容：`docker logs —tail 10 container_id`
- 比较容器文件层数据差异：`docker diff container_id`
- 查看容器内部运行的进程：`docker top container_id`
- 进入正在运行的容器内部：`docker attach container_id`或者`docker exec -it container_id /bin/bash`
- 在运行状态的容器内部运行新进程
  - 在Docker容器内部新建一个新文件
    - `docker exec -d container_id touch /etc/newfile`
  - 启动交互式`shell`：`docker exec -d -i -t container_id bash`
- 停止容器
  - `docker stop container_id`：发送`SIGTERM`信号
  - `docker kill container_id`：发送`SIGKILL`信号，快速停止容器
- 获取某个容器的详细信息：`docker inspect container_id`
- 修改某个容器的名字：`docker rename old_name new_name`
- 查看某个容器资源使用情况
  - `docker stats container_id`，所有指标都是相对于当前容器环境，而非主机环境
- `top`命令：统计容器资源状态，`stats`命令统计的是CPU、内存和网络吞吐数据三项数据，而`top`统计的是容器内运行的进程信息
  - `docker top container_id`
- 删除某个容器（容器必须处于停止运行状态）：`docker rm container_id`
- 列出所有Docker镜像：`docker images`
- 删除某个Docker镜像，首先需要区分`image`和`container`这两个概念，`image`和平常所说的虚拟机的镜像是一个意思，相当于一个模板，而`container`是`image`运行时的状态，Docker对于运行过的`image`都保留一个`container`，可以使用命令`docker ps -a`来查看之前运行过的所有的`container`。由于`image`被某个`container`引用过（拿来运行过），如果不将之前引用过的`container`删除，那`image`就不能被删除
  - `docker ps -a`：列出之前运行过的所有的`container`
  - `docker stop container_id`：停止所有引用过某个`image_id`的`container`
  - `docker rm container_id`：删除所有引用过某个`image_id`的`container`
  - `docker rmi imge_id`：删除`image`
- 搜索镜像：`docker search ubuntu`
- 查看镜像详细信息：`docker inspect image`
- 修改镜像的名称：`docker tag old_image new_image`
- 查看镜像的构建历史：`docker history image_id`
- `tag`命令：每个镜像都会使用ID作为唯一标识，而不一定有名称，镜像ID是Docker自行维护的，在创建镜像时自动生成，而名称则是用户自己维护
  - `docker tag IMAGE[:TAG] NAME[:TAG]`
- Docker的四种网络链接方式
  - bridge（桥接模式）
    - 默认模式，此时主机上存在一个名称为Docker0的网络接口，Docker Daemon会针对容器创建一对veth接口，其中一个veth接口在host充当网卡桥接作用，另一个veth接口存在于容器的网络命令空间中，并且指向容器的loopback，Docker会自动给这个容器分配一个IP，并且将容器内的数据通过桥接转发到外部网络
  - container:<name|id>复用容器模式）
    - 当网络模式设置为container时，这个容器将完全复用另外一个容器的网络堆栈，使用此模式，必须符合下面的格式：`—net container:<name|id>`
  - host（主机模式）
    - 当网络模式设置为host时，这个容器将完全共享host的网络堆栈，host所有的网络接口将完全对容器开放，容器的主机名也会存在于host的hostname中。这时容器所有对外暴露的port和对其他容器的link，将完全失效
  - none
    - 将网络模式设置为none时，这个容器将不允许访问任何外部网络，这个容器内部只会有一个loopback接口，而且不存在任何可以访问外部网络的路由信息
- 使用`pull`命令从仓库下载指定`tag`的镜像（默认是最新）：`docker pull ubuntu:14.04`
- 使用`push`命令向仓库上传镜像：`docker push NAME[:TAG]`
- `import`命令和`load`命令的区别
  - `import`用于加载容器导出的归档文件，而`load`则用于加载镜像归档文件
- `export`命令和`save`命令的区别
  -  `export`用于将容器的文件系统导出为`tar`格式的归档文件，而`save`则是将镜像的文件系统导出为`tar`格式的归档文件
